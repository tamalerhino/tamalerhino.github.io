<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Containers From Scratch Part 2" /><meta property="og:locale" content="en" /><meta name="description" content="In the first part we created a container in the simplest form, using namespaces, chroot, and a little pivot_root magic to isolate our service. But there is still much more to do…" /><meta property="og:description" content="In the first part we created a container in the simplest form, using namespaces, chroot, and a little pivot_root magic to isolate our service. But there is still much more to do…" /><link rel="canonical" href="https://tamalerhino.github.io/posts/container-from-scratch-pt2/" /><meta property="og:url" content="https://tamalerhino.github.io/posts/container-from-scratch-pt2/" /><meta property="og:site_name" content="Tamalerhino’s Blog" /><meta property="og:image" content="https://tamalerhino.github.io/pexels-pixabay-73833.jpg" /><meta property="og:image:height" content="800" /><meta property="og:image:width" content="1000" /><meta property="og:image:alt" content="Containers" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-12T11:00:00-06:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tamalerhino.github.io/pexels-pixabay-73833.jpg" /><meta name="twitter:image:alt" content="Containers" /><meta property="twitter:title" content="Containers From Scratch Part 2" /><meta name="twitter:site" content="@tamalerhino" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-12T11:00:00-06:00","datePublished":"2022-02-12T11:00:00-06:00","description":"In the first part we created a container in the simplest form, using namespaces, chroot, and a little pivot_root magic to isolate our service. But there is still much more to do…","headline":"Containers From Scratch Part 2","image":{"width":1000,"height":800,"alt":"Containers","url":"https://tamalerhino.github.io/pexels-pixabay-73833.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tamalerhino.github.io/posts/container-from-scratch-pt2/"},"url":"https://tamalerhino.github.io/posts/container-from-scratch-pt2/"}</script><title>Containers From Scratch Part 2 | Tamalerhino's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Tamalerhino's Blog"><meta name="application-name" content="Tamalerhino's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/tamalerhino2-1mb.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Tamalerhino's Blog</a></div><div class="site-subtitle font-italic">Just one rhino's thoughts.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tamalerhino" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/tamalerhino" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/ulises-galeano/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Containers From Scratch Part 2</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Containers From Scratch Part 2</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1644685200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 12, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 800'%3E%3C/svg%3E" data-src="/assets/img/posts/pexels-pixabay-73833.jpg" class="preview-img bg" alt="Containers" width="1000" height="800" data-proofer-ignore><figcaption class="pt-2 pb-2">Containers</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/tamalerhino">Ulises Galeano</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1415 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><p>In the first part we created a container in the simplest form, using <code class="language-plaintext highlighter-rouge">namespaces</code>, <code class="language-plaintext highlighter-rouge">chroot</code>, and a little <code class="language-plaintext highlighter-rouge">pivot_root</code> magic to isolate our service. But there is still much more to do…</p><h2 id="further-isolation-or-limits-cgroups"><span class="mr-2">Further Isolation or limits (cgroups)</span><a href="#further-isolation-or-limits-cgroups" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>cgroups, short for control groups, allow kernel-imposed isolation on resources like memory and CPU. This is so one container cant kill things in other containers by using up all the ram etc.</p><p>The kernel exposes cgroups through the <code class="language-plaintext highlighter-rouge">/sys/fs/cgroup</code> directory. If your machine doesn’t have one you may have to <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Resource_Management_Guide/sec-memory.html#memory_example-usage">mount the memory cgroup</a> to follow along.</p><blockquote class="prompt-info"><div><p>This is only to show how cgroups work, in order to add the container to a cgroup you just need to add the <code class="language-plaintext highlighter-rouge">PID</code> of <code class="language-plaintext highlighter-rouge">unshare</code> to the<code class="language-plaintext highlighter-rouge">cgroup.procs</code> file.</p></div></blockquote><blockquote class="prompt-danger"><div><p>Run the following commands in a secondary terminal outside of your container.</p></div></blockquote><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">ls</span> /sys/fs/cgroup/
cgroup.controllers      cpu.stat               io.pressure                    sys-kernel-config.mount
cgroup.max.depth        cpuset.cpus.effective  io.prio.class                  sys-kernel-debug.mount
cgroup.max.descendants  cpuset.mems.effective  io.stat                        sys-kernel-tracing.mount
cgroup.procs            dev-hugepages.mount    memory.numa_stat               system.slice
cgroup.stat             dev-mqueue.mount       memory.pressure                user.slice
cgroup.subtree_control  init.scope             memory.stat
cgroup.threads          io.cost.model          misc.capacity
cpu.pressure            io.cost.qos            sys-fs-fuse-connections.mount
</pre></table></code></div></div><p>For this example, we’ll create a cgroup to restrict the memory of a process.</p><p>In oder to create a cgroup all you need to do is create a directory. we will create one to limit the memory and we will call the folder “meow”. Once the directory has been created, the kernel automatically creates the nesseasary files to configure the cgroup itself.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo mkdir</span> /sys/fs/cgroup/meow
tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">ls</span> /sys/fs/cgroup/meow/
cgroup.controllers      cpu.max                cpuset.mems.effective  memory.min
cgroup.events           cpu.max.burst          io.max                 memory.numa_stat
cgroup.freeze           cpu.pressure           io.pressure            memory.oom.group
cgroup.kill             cpu.stat               io.prio.class          memory.pressure
cgroup.max.depth        cpu.uclamp.max         io.stat                memory.stat
cgroup.max.descendants  cpu.uclamp.min         io.weight              memory.swap.current
cgroup.procs            cpu.weight             memory.current         memory.swap.events
cgroup.stat             cpu.weight.nice        memory.events          memory.swap.high
cgroup.subtree_control  cpuset.cpus            memory.events.local    memory.swap.max
cgroup.threads          cpuset.cpus.effective  memory.high            pids.current
cgroup.type             cpuset.cpus.partition  memory.low             pids.events
cpu.idle                cpuset.mems            memory.max             pids.max
</pre></table></code></div></div><p>To configure the memory value we just need to write to the correspoding file. We will limit it to 100MB of memory.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>su <span class="c">#sudo wont work for some reason</span>
root@localhost:/home/tamalerhino# <span class="nb">echo</span> <span class="s2">"100000000"</span> <span class="o">&gt;</span> /sys/fs/cgroup/meow/memory.max
root@localhost:/home/tamalerhino# <span class="nb">echo</span> <span class="s2">"0"</span> <span class="o">&gt;</span> /sys/fs/cgroup/meow/memory.swap.max
</pre></table></code></div></div><p>In order to assign our process to that cgroup we will need to edit the <code class="language-plaintext highlighter-rouge">cgroup.procs</code> file. By adding our PID into this file.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@localhost:/home/tamalerhino# <span class="nb">echo</span> <span class="nv">$$</span> <span class="o">&gt;</span> /sys/fs/cgroup/meow/cgroup.procs
</pre></table></code></div></div><p>Lets test cgroup by running this script stolen from <a href="https://ericchiang.github.io/post/containers-from-scratch/#cgroups">here</a> I just named the file crash.py</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"/dev/urandom"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="s">""</span>

<span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10000000</span><span class="p">)</span> <span class="c1"># 10mb
</span>    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">print</span> <span class="s">"%dmb"</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">10</span><span class="p">,)</span>
</pre></table></code></div></div><p>If you’ve set up the cgroup correctly, this won’t crash your computer.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>root@localhost:/home/tamalerhino# python2 crash.py
10mb
20mb
30mb
40mb
50mb
60mb
70mb
80mb
Killed
root@localhost:/home/tamalerhino#
</pre></table></code></div></div><p>As you can see it reached that limit and exited my process ie the bash process.</p><p>cgroups can’t be removed until every process in the procs has exited or been reassigned to another group.</p><p>Remove the directory with rmdir (don’t use rm - or you will get the <code class="language-plaintext highlighter-rouge">operation not permited</code> errors).</p><blockquote class="prompt-danger"><div><p>DO NOT DO THIS UNLESS YOU’RE DONE</p></div></blockquote><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>root@localhost:/home/tamalerhino# <span class="nb">exit
exit
</span>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo rmdir</span> /sys/fs/cgroup/meow
</pre></table></code></div></div><h2 id="networking"><span class="mr-2">Networking</span><a href="#networking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now to get some networking in the container so that we can do stuff.</p><p>Start by creating a network namesapce</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~/debian<span class="nv">$ </span><span class="nb">sudo </span>ip netns add vnet0
tamalerhino@localhost:~/debian<span class="nv">$ </span><span class="nb">sudo </span>ip netns
vnet0
</pre></table></code></div></div><p>You can view the ip links in the namespace created as well by running</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip netns <span class="nb">exec </span>vnet0 ip <span class="nb">link
</span>1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000
    <span class="nb">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</pre></table></code></div></div><p>Or you can use the shortcut for <code class="language-plaintext highlighter-rouge">netns exec</code> just as <code class="language-plaintext highlighter-rouge">-n</code> like so:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip <span class="nt">-n</span> vnet0 <span class="nb">link
</span>1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000
    <span class="nb">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</pre></table></code></div></div><p>Now we will create a network bridge/switch</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nb">sudo
</span>tamalerhino@localhost:~/debian<span class="nv">$ </span><span class="nb">sudo </span>ip <span class="nb">link </span>add v-net-0 <span class="nb">type </span>bridge
tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip <span class="nb">link
</span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    <span class="nb">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    <span class="nb">link</span>/ether 00:0c:29:49:53:03 brd ff:ff:ff:ff:ff:ff
    altname enp2s1
8: v-net-0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default qlen 1000
    <span class="nb">link</span>/ether 12:d5:3c:e1:f8:e6 brd ff:ff:ff:ff:ff:ff
</pre></table></code></div></div><p>And we will bring the network bridge “UP”</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip <span class="nb">link set </span>dev v-net-0 up
</pre></table></code></div></div><p>Now we will connect the namespace to this swich. Begin by creating the link pipe or ‘cable’</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip <span class="nb">link </span>add veth0 <span class="nb">type </span>veth peer name veth0-br
</pre></table></code></div></div><p>Then attach it to the namespace</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip <span class="nb">link set </span>veth0 netns vnet0
</pre></table></code></div></div><p>and then the virtual switch</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip <span class="nb">link set </span>veth0-br master v-net-0
</pre></table></code></div></div><p>Now lets give the namespace an ip address</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip <span class="nt">-n</span> vnet0 addr add 192.168.15.1/24 dev veth0
</pre></table></code></div></div><p>And turn all the devices to “UP”</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip <span class="nt">-n</span> vnet0 <span class="nb">link set </span>veth0 up
tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip <span class="nb">link set </span>veth0-br up
</pre></table></code></div></div><p>Now to check we can run the following commands</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip <span class="nt">-n</span> vnet0 <span class="nb">link
</span>1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000
    <span class="nb">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
10: veth0@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000
    <span class="nb">link</span>/ether 6a:d8:d4:88:d0:2c brd ff:ff:ff:ff:ff:ff link-netnsid 0

tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip <span class="nt">-n</span> vnet0 addr
1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000
    <span class="nb">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
10: veth0@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    <span class="nb">link</span>/ether 6a:d8:d4:88:d0:2c brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 192.168.15.1/32 scope global veth0
       valid_lft forever preferred_lft forever
    inet6 fe80::68d8:d4ff:fe88:d02c/64 scope <span class="nb">link
       </span>valid_lft forever preferred_lft forever
</pre></table></code></div></div><p>Now this is good we have a network stack in the cointainer itself but it cannot access anything outside of it, and the host also cannot access the container inside.</p><p>So we will go ahead and connect our host to that switch for interconnectivity first.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip addr add 192.168.15.5/24 dev v-net-0
</pre></table></code></div></div><p>You might also need to put in a policy to allow network forwarding</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>iptables <span class="nt">--policy</span> FORWARD ACCEPT
</pre></table></code></div></div><p>Now to test!</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span>ping 192.168.15.1
PING 192.168.15.1 <span class="o">(</span>192.168.15.1<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 192.168.15.1: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.088 ms
.....

</pre></table></code></div></div><p>It works!!</p><p>However all you got rght now is connectivity from the host to the container, now to add connectivity from the container to the host. We can do that by adding a route to tell your container to forward the traffic through the virtual switch. Make sure to replace <code class="language-plaintext highlighter-rouge">192.168.22.0/34</code> with your hosts IP</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip netns <span class="nb">exec </span>vnet0 ip route add 192.168.22.0/24 via 192.168.15.5
</pre></table></code></div></div><p>Now test it</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip netns <span class="nb">exec </span>vnet0 ping 192.168.22.144
PING 192.168.22.144 <span class="o">(</span>192.168.22.144<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 192.168.22.144: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.029 ms
64 bytes from 192.168.22.144: <span class="nv">icmp_seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.064 ms
</pre></table></code></div></div><p>Great that works! But what if you wanted to allow other things from outside of the host to connect to your container? For example if you were hosting a web service.</p><p>We will essentially need to enable NATing on the host acting as the gateway to allow the container send and receive traffic with its own name and address.</p><p>Again first lets enable traffic from the container to the outside world by adding a nat rule in our IP tables and a new route.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>iptables <span class="nt">-t</span> nat <span class="nt">-A</span> POSTROUTING <span class="nt">-s</span> 192.168.15.0/24 <span class="nt">-j</span> MASQUERADE
tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>ip netns <span class="nb">exec </span>vnet0 ip route add default via 192.168.15.5
</pre></table></code></div></div><p>And now finally adding port forwarding! Below is just an example. Since we are not running anything on port 80 at the moment you wont be able to hit anything.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tamalerhino@localhost:~<span class="nv">$ </span>tamalerhino@localhost:~<span class="nv">$ </span><span class="nb">sudo </span>iptables <span class="nt">-t</span> nat <span class="nt">-A</span> PREROUTING <span class="nt">-p</span> tcp <span class="nt">--dport</span> 80 <span class="nt">-j</span> DNAT <span class="nt">--to-destination</span> 192.168.15.1:80
</pre></table></code></div></div><p>Below you can see how you can enter the namespace with the networking we just setup.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>unshare <span class="nt">--mount</span> <span class="nt">--uts</span> <span class="nt">--net</span><span class="o">=</span>/var/run/netns/vnet0 <span class="nt">--ipc</span> <span class="nt">--pid</span> <span class="nt">--mount-proc</span><span class="o">=</span>/proc <span class="nt">--fork</span> bash
</pre></table></code></div></div><p>There is still so much to learn, in order to learn about container security I recommend you read into Linux Capabilites, Seccomp AppArmor, and of course good ol’ SELinux.</p><h1 id="resources">Resources</h1><ul><li>https://ericchiang.github.io/post/containers-from-scratch/<li>https://iximiuz.com/en/posts/container-networking-is-simple/<li>https://gist.github.com/cfra/39f4110366fa1ae9b1bddd1b47f586a3<li>https://man7.org/linux/man-pages/man8/ip-netns.8.html<li>https://stackoverflow.com/questions/67971506/use-unshare-to-start-process-in-existing-net-namespace</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/containerization/'>Containerization</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/containerization/" class="post-tag no-text-decoration" >containerization</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Containers+From+Scratch+Part+2+-+Tamalerhino%27s+Blog&url=https%3A%2F%2Ftamalerhino.github.io%2Fposts%2Fcontainer-from-scratch-pt2%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Containers+From+Scratch+Part+2+-+Tamalerhino%27s+Blog&u=https%3A%2F%2Ftamalerhino.github.io%2Fposts%2Fcontainer-from-scratch-pt2%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftamalerhino.github.io%2Fposts%2Fcontainer-from-scratch-pt2%2F&text=Containers+From+Scratch+Part+2+-+Tamalerhino%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/container-from-scratch/">Containers From Scratch Part 1</a><li><a href="/posts/systemd-namespace-containers/">Systemd Namespace Containers</a><li><a href="/posts/docker-debian-airgapped/">Install Docker Air Gapped</a><li><a href="/posts/docker-desktop-wsl2-deep-dive/">Docker Desktop WSL2 Deep Dive</a><li><a href="/posts/how-to-abuse-container-repositories-for-fun-and-profit/">How To Abuse Container Repositories For Fun And Profit</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/containerization/">containerization</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/docker-desktop/">docker desktop</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/wsl2/">wsl2</a> <a class="post-tag" href="/tags/wsl/">wsl</a> <a class="post-tag" href="/tags/data-exfiltration/">data exfiltration</a> <a class="post-tag" href="/tags/devsecops/">devsecops</a> <a class="post-tag" href="/tags/dlp/">dlp</a> <a class="post-tag" href="/tags/hacking/">hacking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/docker-desktop-wsl2-deep-dive/"><div class="card-body"> <em class="small" data-ts="1633107600" data-df="ll" > Oct 1, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Docker Desktop WSL2 Deep Dive</h3><div class="text-muted small"><p> In the last few years theres been a big push for Docker Desktop on developer workstations, many of those workstations being Mac and Windows not Linux. But since containers need a Linux kernel to ru...</p></div></div></a></div><div class="card"> <a href="/posts/how-to-abuse-container-repositories-for-fun-and-profit/"><div class="card-body"> <em class="small" data-ts="1635008400" data-df="ll" > Oct 23, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How To Abuse Container Repositories For Fun And Profit</h3><div class="text-muted small"><p> Often as security engineers we are worried about what vulnerabilites can be downloaded from container registries, howver i believe the same could be used to exfiltrate data. We will go over what a...</p></div></div></a></div><div class="card"> <a href="/posts/creating-a-custom-wsl2-image/"><div class="card-body"> <em class="small" data-ts="1636650000" data-df="ll" > Nov 11, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Creating A Custom WSL2 Image</h3><div class="text-muted small"><p> Recently with the usage of Docker Desktop, there has been a need to use WSL2 to run Docker Desktop on Windows. However because of the various security implications, missing security kernel modules,...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/container-from-scratch/" class="btn btn-outline-primary" prompt="Older"><p>Containers From Scratch Part 1</p></a> <a href="/posts/systemd-namespace-containers/" class="btn btn-outline-primary" prompt="Newer"><p>Systemd Namespace Containers</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/tamalerhino">Ulises Galeano</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/containerization/">containerization</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/docker-desktop/">docker desktop</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/wsl2/">wsl2</a> <a class="post-tag" href="/tags/wsl/">wsl</a> <a class="post-tag" href="/tags/data-exfiltration/">data exfiltration</a> <a class="post-tag" href="/tags/devsecops/">devsecops</a> <a class="post-tag" href="/tags/dlp/">dlp</a> <a class="post-tag" href="/tags/hacking/">hacking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
